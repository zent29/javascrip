<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login</title>
    <style>
      body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#f3f4f6; margin:0; padding:2rem; display:flex; align-items:center; justify-content:center; min-height:100vh; }
      .card { background:white; padding:1.5rem; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.06); width:320px; }
      label{display:block;margin-bottom:0.25rem;font-weight:600}
      input{width:100%;padding:0.5rem;margin-bottom:0.75rem;border:1px solid #ddd;border-radius:6px}
      button{width:100%;padding:0.6rem;border:0;border-radius:6px;background:#2563eb;color:white;font-weight:600}
      .error{color:#b91c1c;margin-bottom:0.5rem}
    </style>
  </head>
  <body>
    <div class="card">
      <h2 style="margin:0 0 1rem 0">Iniciar sesión</h2>
      <div id="error" class="error" aria-live="polite" style="display:none"></div>
      <form id="loginForm">
        <label for="user">Usuario</label>
        <input id="user" name="user" autocomplete="username" required />
        <label for="pass">Contraseña</label>
        <input id="pass" name="pass" type="password" autocomplete="current-password" required />
        <button type="submit">Entrar</button>
      </form>
    </div>

    <!-- Incluir el módulo de autenticación centralizado -->
    <script src="auth.js"></script>
    <script>
      // Obtener referencias a elementos del DOM
      const form = document.getElementById('loginForm');
      const errorDiv = document.getElementById('error');

      // Manejar el evento submit del formulario
      form.addEventListener('submit', function(e){
        e.preventDefault(); // evitar envío clásico y recarga
        // leer valores de los campos
        const user = document.getElementById('user').value.trim();
        const pass = document.getElementById('pass').value;

        // Usar Auth.login para validar y guardar sesión si corresponde
        if(Auth.login(user, pass)){
          // Credenciales válidas: redirigir a la página protegida
          window.location.href = 'p1.html';
        } else {
          // Credenciales inválidas: mostrar error y limpiar contraseña
          errorDiv.textContent = 'Usuario o contraseña incorrectos. Vuelva a intentarlo.';
          errorDiv.style.display = 'block';
          document.getElementById('pass').value = '';
          document.getElementById('pass').focus();
        }
      });

      // Mostrar mensajes pasados por query string (ej. ?logged=0 al cerrar sesión)
      (function showQueryMessages(){
        const params = new URLSearchParams(window.location.search);
        if(params.get('logged') === '0'){
          // Mostrar mensaje informativo sobre logout
          errorDiv.textContent = 'Sesión cerrada. Inicie sesión de nuevo.';
          errorDiv.style.display = 'block';
        }
      })();
    </script>
  </body>
</html>
